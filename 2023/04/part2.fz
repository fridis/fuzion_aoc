dec4_part2 is

  lines =>
    LM : mutate is
    o := LM ! ()->(io.stdin.reader LM) ! ()->
      for
        li Sequence String := [], li ++ [l]
        l := io.buffered LM .read_line ? str String => str | * => ""
      while l != ""  else
        li
    o.as_array

  card(s String) is
    wy(i) => ((s.split ":")[1].split "|")[i].split.map (.parse_i32.val)
    win => wy 0
    you => wy 1
    matches => ((win.combine you (=)).filter x->x).count
    winning => 1 << matches >> 1

  cards := (lines.map (s->card s)).as_array

  part1 := cards.map (.winning)
                .fold i32.type.sum

  lm : mutate is
  part2 := lm ! ()->
    a := (lm.array i32).type.new lm cards.count.as_i64 1
    for i in cards.indices do
      m := cards[i].matches
      for j in i+1..i+m do
        a[j.as_i64] := a[j.as_i64] + a[i.as_i64]
    a.as_array.fold i32.type.sum

  say "dec 4: $part1 $part2"
